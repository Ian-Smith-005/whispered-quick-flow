<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Diacare | Dashboard</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!--fontawesom icons-->
    <script
      src="https://kit.fontawesome.com/f3068f95b3.js"
      crossorigin="anonymous"
    ></script>

    <!--favicon-->
    <link
      rel="shortcut icon"
      href="assets/img/logo_&_favicon/logo_diacare.png"
      type="image/x-icon"
    />

    <!--Graph JS-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--Google Fonts-->
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/dashboard.css" />
    <link rel="stylesheet" href="assets/css/ai.css" />
    <link rel="stylesheet" href="assets/css/user.css" />
    <link rel="stylesheet" href="assets/css/tips.css" />
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>

  <!-- Delete Confirmation Modal -->
  <div
    class="modal fade"
    id="deleteModal"
    tabindex="-1"
    aria-labelledby="deleteModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content border-danger">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="deleteModalLabel">
            Confirm Account Deletion
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
          ></button>
        </div>
        <div class="modal-body">
          <p class="mb-3">
            Type <strong>DELETE</strong> to confirm permanent account deletion.
          </p>
          <input
            type="text"
            id="deleteConfirmInput"
            class="form-control"
            placeholder="Type DELETE to confirm"
          />
          <div id="deleteError" class="text-danger small mt-2 d-none">
            ‚ùå You must type DELETE in uppercase to proceed.
          </div>
          <div id="deleteSuccess" class="text-success small mt-2 d-none">
            ‚úÖ Account successfully deleted. Redirecting...
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
          <button class="btn btn-danger" id="confirmDeleteBtn">
            Confirm Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->

  <body>
    <!-- Preloader (for initial load and section change) -->
    <div class="preloader-overlay" id="sectionPreloader">
      <div class="ripple-loader">
        <span class="circle"></span>
        <span class="circle"></span>
        <span class="circle"></span>
        <div class="center-dot"></div>
      </div>
    </div>

    <!-- Sidebar Navigation (Desktop) -->
    <div class="sidebar d-none d-md-block">
      <h4 class="text-center text-success fw-bold mb-4">Diacare</h4>
      <nav class="nav flex-column">
        <a href="#" class="nav-link active" data-target="dashboard"
          ><i class="fa-solid fa-chart-line"></i> Dashboard</a
        >
        <a href="#" class="nav-link" data-target="mealplans"
          ><i class="fa-solid fa-utensils"></i> Meal Plans</a
        >
        <a href="#" class="nav-link" data-target="analysis"
          ><i class="fa-solid fa-brain"></i> Analysis</a
        >
        <a href="#" class="nav-link" data-target="tips"
          ><i class="fa-regular fa-lightbulb"></i> Tips</a
        >
        <a href="#" class="nav-link" data-target="profile"
          ><i class="fa-regular fa-user"></i> Profile</a
        >
        <hr style="border-color: rgba(255,255,255,0.2); margin: 1rem 0;">
        <a href="#" class="nav-link text-danger" data-logout
          ><i class="fa-solid fa-right-from-bracket"></i> Logout</a
        >
      </nav>
    </div>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav d-flex d-md-none justify-content-around">
      <a href="#" class="nav-link active" data-target="dashboard"
        ><i class="fa-solid fa-chart-line"></i
      ></a>
      <a href="#" class="nav-link" data-target="mealplans"
        ><i class="fa-solid fa-utensils"></i
      ></a>
      <a href="#" class="nav-link" data-target="analysis"
        ><i class="fa-solid fa-brain"></i
      ></a>
      <a href="#" class="nav-link" data-target="tips"
        ><i class="fa-regular fa-lightbulb"></i
      ></a>
      <a href="#" class="nav-link" data-target="profile"
        ><i class="fa-regular fa-user"></i
      ></a>
    </nav>

    <!-- Main Content -->
    <div class="main-content-wrapper">
      <div id="dashboard" class="content-section active">
        <div class="container my-4">
          <!-- Row 1: Quick Stats -->
          <div class="row mb-4">
            <div class="col-md-3 quick-stats">
              <div class="card text-center shadow-sm">
                <div class="card-body">
                  <h6 class="card-title">Current Glucose</h6>
                  <h4 class="text-success">108 mg/dL</h4>
                  <p class="text-muted">Normal Range</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 quick-stats">
              <div class="card text-center shadow-sm">
                <div class="card-body">
                  <h6 class="card-title">Last Meal</h6>
                  <p>Grilled chicken & salad</p>
                  <span class="badge bg-success">Low Impact</span>
                </div>
              </div>
            </div>
            <div class="col-md-3 quick-stats">
              <div class="card text-center shadow-sm">
                <div class="card-body">
                  <h6 class="card-title">Medication</h6>
                  <p>Metformin 500mg</p>
                  <p class="text-muted">2 hrs ago</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 quick-stats">
              <div class="card text-center shadow-sm">
                <div class="card-body">
                  <h6 class="card-title">Activity</h6>
                  <p>Steps: 3,200</p>
                  <span class="badge bg-warning text-dark">Goal: 8,000</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Row 2: Glucose Chart + Meals -->
          <div class="row mb-4">
            <div class="col-md-8">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Glucose Trend (Past 7 Days)</h5>
                  <canvas id="glucoseChartdash" height="150"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Today's Meals</h5>
                  <ul class="list-group">
                    <li class="list-group-item">
                      Oatmeal & berries
                      <span class="badge bg-success float-end">Good</span>
                    </li>
                    <li class="list-group-item">
                      Chicken wrap
                      <span class="badge bg-info float-end">Neutral</span>
                    </li>
                    <li class="list-group-item">
                      White rice
                      <span class="badge bg-danger float-end">Spike</span>
                    </li>
                  </ul>
                  <a href="#" data-target="mealplans">
                    <button
                      class="btn btn-sm btn-outline-primary mt-3 w-100 add-meal-btn"
                    >
                      Add Meal
                    </button>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Row 3: AI Analysis & Recommendations -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Recent AI Analysis</h5>
                  <ul class="list-group">
                    <li class="list-group-item">
                      White rice caused a spike of 30 mg/dL.
                    </li>
                    <li class="list-group-item">
                      Glucose steady after quinoa bowl.
                    </li>
                    <li class="list-group-item">
                      Sugary drinks flagged twice this week.
                    </li>
                  </ul>
                  <a href="#" data-target="analysis">
                    <button
                      class="btn btn-sm btn-outline-success mt-3 AI-analysis-btn"
                    >
                      View All
                    </button>
                  </a>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Food Recommendations</h5>
                  <div class="alert alert-success mb-2">
                    Try a quinoa bowl for dinner ‚Äì low GI and nutrient-rich.
                  </div>
                  <div class="alert alert-warning mb-2">
                    Reduce white rice intake ‚Äì repeated spike detected.
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Row 4: News + Weekly Goals -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Latest News</h5>
                  <ul class="list-group">
                    <li class="list-group-item">
                      <strong>Study:</strong> Low-carb diets improve Type 2
                      diabetes outcomes.
                    </li>
                    <li class="list-group-item">
                      <strong>FDA:</strong> Approves new CGM tech for home use.
                    </li>
                    <li class="list-group-item">
                      <strong>Nutrition Tip:</strong> Avoid hidden sugars in
                      sauces.
                    </li>
                  </ul>
                  <a href="#" data-target="tips">
                    <button
                      class="btn btn-sm btn-outline-secondary mt-3 tips-btn"
                    >
                      More Articles
                    </button>
                  </a>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Weekly Goal Progress</h5>
                  <p>
                    In target glucose range: <strong>60%</strong> (Goal: 80%)
                  </p>
                  <div class="progress mb-3">
                    <div class="progress-bar bg-success" style="width: 60%">
                      60%
                    </div>
                  </div>
                  <p>Meals logged: <strong>5 / 7 days</strong></p>
                  <div class="progress">
                    <div class="progress-bar bg-info" style="width: 71%">
                      71%
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Row 5: Meal Plan -->
          <div class="row mb-5">
            <div class="col-md-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Suggested Meal Plan</h5>
                  <div class="row">
                    <div class="col-md-4">
                      <strong>Breakfast:</strong>
                      <ul>
                        <li>Oatmeal with chia seeds</li>
                        <li>Green tea</li>
                      </ul>
                    </div>
                    <div class="col-md-4">
                      <strong>Lunch:</strong>
                      <ul>
                        <li>Grilled salmon</li>
                        <li>Steamed vegetables</li>
                        <li>Quinoa</li>
                      </ul>
                    </div>
                    <div class="col-md-4">
                      <strong>Dinner:</strong>
                      <ul>
                        <li>Lentil soup</li>
                        <li>Mixed greens salad</li>
                        <li>Avocado toast</li>
                      </ul>
                    </div>
                  </div>
                  <a href="#" data-target="mealplans">
                    <button
                      class="btn btn-sm btn-outline-success mt-3 add-meal-btn"
                    >
                      Customize Plan
                    </button>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <!-- Row: AI Searches + Appointments -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Recent AI Prompts</h5>
                  <ul class="list-group">
                    <li class="list-group-item">
                      Analyze sweet potato glycemic index
                    </li>
                    <li class="list-group-item">
                      What‚Äôs in this meal (uploaded image)
                    </li>
                    <li class="list-group-item">
                      Suggest low-carb Kenyan lunch ideas
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Upcoming Appointments</h5>
                  <ul class="list-group">
                    <li class="list-group-item">
                      Endocrinologist ‚Äì June 25 @ 10:00 AM
                    </li>
                    <li class="list-group-item">
                      HbA1c Lab Test ‚Äì July 2 @ 8:30 AM
                    </li>
                    <li class="list-group-item">Dietician Check-In ‚Äì July 8</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Row: Weight & BP Trends -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Weight Trend (Last 6 Weeks)</h5>
                  <canvas id="weightChartdash" height="150"></canvas>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Blood Pressure Trend</h5>
                  <canvas id="bpChartdash" height="150"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Row: Daily Tips -->
          <div class="row mb-5">
            <div class="col-md-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Daily Wellness Tip</h5>
                  <blockquote class="blockquote mb-0">
                    <p>
                      üö∂‚Äç‚ôÇÔ∏è A 15-minute walk after meals can significantly improve
                      your blood sugar control.
                    </p>
                    <footer class="blockquote-footer">AI Care Assistant</footer>
                  </blockquote>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="mealplans" class="content-section">
        <div class="container">
          <!-- Meal Entry Form -->
          <h4 class="section-title">
            <i class="fas fa-plus-circle me-2"></i>Log a Meal
          </h4>
          <div class="card shadow-sm mb-5">
            <div class="card-body">
              <!-- Image Analysis Buttons -->
              <div class="mb-3 d-flex gap-2">
                <button type="button" class="btn btn-primary" id="uploadMealImage">
                  <i class="fas fa-image"></i> Upload Photo
                </button>
                <button type="button" class="btn btn-info" id="takeMealPhoto">
                  <i class="fas fa-camera"></i> Take Photo
                </button>
              </div>
              
              <!-- Analysis Result Container -->
              <div id="mealAnalysisResult" class="mb-3" style="display: none;"></div>

              <form id="mealForm">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Meal Name</label>
                    <input
                      type="text"
                      class="form-control"
                      name="mealName"
                      placeholder="e.g. Chicken Salad"
                      required
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Meal Type</label>
                    <select class="form-select" name="mealType" required>
                      <option value="" disabled selected>Select</option>
                      <option value="breakfast">Breakfast</option>
                      <option value="lunch">Lunch</option>
                      <option value="dinner">Dinner</option>
                      <option value="snack">Snack</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Calories</label>
                    <input
                      type="number"
                      class="form-control"
                      name="calories"
                      placeholder="e.g. 350"
                    />
                  </div>
                  <div class="col-md-12">
                    <label class="form-label">Description</label>
                    <textarea
                      class="form-control"
                      name="description"
                      rows="2"
                      placeholder="Optional: Describe your meal..."
                    ></textarea>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Carbs (g)</label>
                    <input
                      type="number"
                      step="0.1"
                      class="form-control"
                      name="carbs"
                      placeholder="e.g. 45"
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Protein (g)</label>
                    <input
                      type="number"
                      step="0.1"
                      class="form-control"
                      name="protein"
                      placeholder="e.g. 25"
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Fat (g)</label>
                    <input
                      type="number"
                      step="0.1"
                      class="form-control"
                      name="fat"
                      placeholder="e.g. 15"
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Fiber (g)</label>
                    <input
                      type="number"
                      step="0.1"
                      class="form-control"
                      name="fiber"
                      placeholder="e.g. 5"
                    />
                  </div>
                  <div class="col-md-12 d-flex justify-content-end">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-check"></i> Log Meal
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Meal History -->
          <h4 class="section-title">
            <i class="fas fa-history me-2"></i>Recent Meals
          </h4>
          <div class="card shadow-sm mb-5">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>Time</th>
                      <th>Meal Name</th>
                      <th>Type</th>
                      <th>Calories</th>
                      <th>Carbs (g)</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="mealsTableBody">
                    <tr>
                      <td colspan="6" class="text-center">Loading meals...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Tips Section -->
          <h4 class="section-title">
            <i class="fas fa-lightbulb me-2"></i>Quick Tips
          </h4>
          <div class="row g-3 mb-5">
            <div class="col-md-4">
              <div class="alert alert-success">
                <i class="fas fa-apple-alt me-2"></i> Eat whole fruits over
                juice.
              </div>
            </div>
            <div class="col-md-4">
              <div class="alert alert-info">
                <i class="fas fa-balance-scale me-2"></i> Pair carbs with
                protein to stabilize glucose.
              </div>
            </div>
            <div class="col-md-4">
              <div class="alert alert-warning">
                <i class="fas fa-bread-slice me-2"></i> Watch out for white
                bread & refined starches.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!--Artificial Intelligence page-->
      <div id="analysis" class="content-section">
        <div class="chat-wrapper">
          <!-- Header -->
          <div class="chat-header">Diacare Assistant</div>
          <button
            id="clearChat"
            class="btn btn-danger btn-sm mb-2 mx-auto d-block"
          >
            <i class="fa-regular fa-trash-can"></i> Clear Chat History
          </button>
          <!-- Chat Messages -->
          <div class="chat-messages d-flex flex-column" id="chatMessages">
            <div class="chat-message bot">
              üëã Hello! I'm here to help you manage your meals and health.
            </div>
          </div>

          <!-- Input Area -->
          <div class="chat-input-area">
            <form id="chatForm" class="chat-input-bar">
              <input
                type="text"
                id="chatInput"
                placeholder="Type your message..."
                autocomplete="off"
              />
              <button class="btn-success-send" type="submit">
                <i class="fas fa-arrow-up"></i>
              </button>

              <!-- Plus button -->
              <button class="plus-btn" id="plusBtn" type="button">
                <i class="fas fa-plus"></i> Attatch
              </button>
              <!--Voice icon-->
              <button class="voice-btn" type="button">
                <i class="fa-solid fa-microphone-lines"></i> Voice
              </button>

              <!-- Upload menu -->
              <div class="upload-menu" id="uploadMenu">
                <div class="upload-menu-item" id="takePhotoBtn">
                  <i class="fas fa-camera"></i> Take a Photo
                </div>
                <div class="upload-menu-item" id="uploadFileBtn">
                  <i class="fas fa-upload"></i> Upload a File
                </div>
              </div>

              <!--upload hidden input-->
              <!-- Hidden file input -->
              <input
                type="file"
                id="imageInput"
                accept="image/*"
                capture="environment"
                style="display: none"
              />
            </form>
            <br />
          </div>
        </div>
      </div>
      <!--Artificial Intelligence page-->

      <div id="tips" class="content-section">
        <div class="container">
          <h4 class="section-title">
            <i class="fas fa-heartbeat me-2"></i>Healthy Living Tips
          </h4>
          <div class="row g-4">
            <div class="col-md-6 col-lg-4">
              <div class="card tip-card p-3">
                <div class="d-flex align-items-start">
                  <div class="tip-icon"><i class="fas fa-seedling"></i></div>
                  <div>
                    <h6>Choose Low-GI Foods</h6>
                    <p class="text-muted">
                      Swap high-GI foods like white rice for whole grains to
                      maintain steady blood sugar levels.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="card tip-card p-3">
                <div class="d-flex align-items-start">
                  <div class="tip-icon"><i class="fas fa-walking"></i></div>
                  <div>
                    <h6>Stay Active</h6>
                    <p class="text-muted">
                      Aim for at least 30 minutes of brisk walking daily to
                      boost insulin sensitivity.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="card tip-card p-3">
                <div class="d-flex align-items-start">
                  <div class="tip-icon"><i class="fas fa-spa"></i></div>
                  <div>
                    <h6>Manage Stress</h6>
                    <p class="text-muted">
                      Incorporate meditation, deep breathing, or yoga to reduce
                      cortisol and improve glucose control.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="card tip-card p-3">
                <div class="d-flex align-items-start">
                  <div class="tip-icon"><i class="fas fa-bed"></i></div>
                  <div>
                    <h6>Prioritize Sleep</h6>
                    <p class="text-muted">
                      Aim for 7‚Äì9 hours of quality sleep to keep hormones in
                      balance and aid recovery.
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="card tip-card p-3">
                <div class="d-flex align-items-start">
                  <div class="tip-icon"><i class="fas fa-tint"></i></div>
                  <div>
                    <h6>Hydrate Often</h6>
                    <p class="text-muted">
                      Staying hydrated helps the kidneys flush excess sugar
                      through urine.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- News Section -->
          <h4 class="section-title mt-5">
            <i class="fas fa-newspaper me-2"></i>Latest News & Articles
          </h4>
          <div class="row g-4">
            <div class="col-md-6 col-lg-4">
              <div class="card news-card p-3">
                <img
                  src="https://cdn.pixabay.com/photo/2018/11/11/19/19/fruit-3809497_960_720.jpg"
                  class="news-thumbnail"
                  alt="news"
                />
                <span class="badge badge-category mb-2">Nutrition</span>
                <h6>5 New Superfoods That Help Stabilize Blood Sugar</h6>
                <p class="text-muted small">
                  Researchers reveal how berries, flaxseed, and more can support
                  diabetic health.
                </p>
                <a href="#" class="btn btn-sm btn-outline-success">Read More</a>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="card news-card p-3">
                <img
                  src="https://cdn.pixabay.com/photo/2021/03/27/10/43/yoga-6128116_1280.jpg"
                  class="news-thumbnail"
                  alt="news"
                />
                <span class="badge badge-category mb-2">Exercise</span>
                <h6>Best Workouts for Type 2 Diabetes</h6>
                <p class="text-muted small">
                  From resistance training to yoga ‚Äì which exercise helps the
                  most?
                </p>
                <a href="#" class="btn btn-sm btn-outline-success">Read More</a>
              </div>
            </div>
            <div class="col-md-6 col-lg-4">
              <div class="card news-card p-3">
                <img
                  src="https://cdn.pixabay.com/photo/2020/04/13/11/20/medicine-5037941_1280.jpg"
                  class="news-thumbnail"
                  alt="news"
                />
                <span class="badge badge-category mb-2">AI & Health</span>
                <h6>How AI Is Changing Diabetes Management</h6>
                <p class="text-muted small">
                  AI-powered assistants like Diacare are enabling better meal
                  planning and prediction.
                </p>
                <a href="#" class="btn btn-sm btn-outline-success">Read More</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="profile" class="content-section">
        <!-- Navbar -->

        <!-- Content -->
        <div class="container my-4">
          <!-- User Info + Glucose Chart -->
          <div class="row mb-4">
            <!-- Profile Card -->
            <div class="col-md-4">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">User Profile</h5>
                  <p><strong>Name:</strong> <span id="userName">Loading...</span></p>
                  <p><strong>Email:</strong> <span id="userEmail">Loading...</span></p>
                  <p><strong>Member Since:</strong> <span id="memberSince">2025</span></p>
                  <button class="btn btn-danger btn-sm mt-3 w-100" data-logout>
                    <i class="fa-solid fa-right-from-bracket me-2"></i>Logout
                  </button>
                </div>
              </div>
            </div>

            <!-- Glucose + Metrics -->
            <div class="col-md-8">
              <div class="card shadow-sm mb-3">
                <div class="card-body">
                  <h5 class="card-title">Latest Health Metrics</h5>
                  <div class="row text-center">
                    <div class="col-md-3">
                      <p><strong>Glucose</strong></p>
                      <h4 class="text-success">112 mg/dL</h4>
                    </div>
                    <div class="col-md-3">
                      <p><strong>HbA1c</strong></p>
                      <h4>6.3%</h4>
                    </div>
                    <div class="col-md-3">
                      <p><strong>Weight</strong></p>
                      <h4>165 lbs</h4>
                    </div>
                    <div class="col-md-3">
                      <p><strong>Blood Pressure</strong></p>
                      <h4>120/80</h4>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Glucose Chart -->
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Glucose Trend</h5>
                  <canvas id="glucoseChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Graphs -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Weight Trend</h5>
                  <canvas id="weightChart"></canvas>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Blood Pressure Trend</h5>
                  <canvas id="bpChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Logs -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Recent Glucose Readings</h5>
                  <ul class="list-group">
                    <li class="list-group-item">
                      June 22, 7:30 AM ‚Äî <strong>102 mg/dL</strong>
                    </li>
                    <li class="list-group-item">
                      June 21, 12:45 PM ‚Äî <strong>135 mg/dL</strong>
                    </li>
                    <li class="list-group-item">
                      June 20, 8:00 PM ‚Äî <strong>118 mg/dL</strong>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Recent Meals Logged</h5>
                  <ul class="list-group">
                    <li class="list-group-item">
                      Oatmeal w/ berries ‚Äî <em>low impact</em>
                    </li>
                    <li class="list-group-item">
                      Grilled chicken & veggies ‚Äî <em>neutral</em>
                    </li>
                    <li class="list-group-item">
                      White rice bowl ‚Äî <em>high spike</em>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Suggestions -->
          <div class="row mb-4">
            <div class="col-md-12">
              <div class="card shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Food Suggestions</h5>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="alert alert-success">
                        <strong>Try:</strong> Quinoa & mixed greens<br />
                        <small>Stable post-meal glucose</small>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="alert alert-success">
                        <strong>Snack:</strong> Greek yogurt & nuts<br />
                        <small>Low-carb, protein-rich</small>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="alert alert-warning">
                        <strong>Avoid:</strong> Sugary cereal<br />
                        <small>Caused spike to 170 mg/dL</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Account Buttons -->
          <div class="text-center mb-5">
            <button
              class="btn btn-danger me-2 delete-btn-custom"
              data-bs-toggle="modal"
              data-bs-target="#deleteModal"
            >
              Delete Account
            </button>

            <button class="btn btn-secondary logout-btn-custom" data-logout>
              <i class="fa-solid fa-right-from-bracket me-2"></i>Logout
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- JS -->
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/session-check.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/account_deletion.js"></script>
    <script src="assets/js/graph_js/dashboard_user_graph.js"></script>
    
    <!-- New backend integration scripts -->
    <script type="module">
      import { initializeChat } from './assets/js/ai-chat.js';
      import { initializeMealImageAnalysis } from './assets/js/meal-image-analysis.js';
      import { loadDailyTips } from './assets/js/tips-loader.js';
      import { loadProfileAnalysis } from './assets/js/profile-loader.js';
      import { 
        addMeal, 
        getMeals, 
        addGlucoseReading, 
        getGlucoseReadings,
        addUserMetric,
        getUserMetrics,
        updateUserProfile,
        getUserProfile 
      } from './assets/js/dashboard-data.js';

      // Initialize when DOM is ready
      document.addEventListener('DOMContentLoaded', () => {
        initializeChat();
        initializeMealImageAnalysis();
        loadDashboardData();
        setupForms();
        
        // Load AI content when sections are viewed
        const tipsSection = document.getElementById('tips');
        const profileSection = document.getElementById('profile');
        
        // Check if already on tips or profile section
        if (tipsSection && tipsSection.classList.contains('active')) {
          loadDailyTips();
        }
        if (profileSection && profileSection.classList.contains('active')) {
          loadProfileAnalysis();
        }
      });

      // Load dashboard data
      async function loadDashboardData() {
        try {
          // Load recent meals
          const mealsResult = await getMeals(10);
          if (mealsResult.success) {
            displayRecentMeals(mealsResult.data);
          }

          // Load recent glucose readings
          const glucoseResult = await getGlucoseReadings(10);
          if (glucoseResult.success) {
            displayGlucoseStats(glucoseResult.data);
          }

          // Load user profile
          const profileResult = await getUserProfile();
          if (profileResult.success && profileResult.data) {
            displayUserProfile(profileResult.data);
          }
        } catch (error) {
          console.error('Error loading dashboard data:', error);
        }
      }

      // Setup form handlers
      function setupForms() {
        // Meal logging form
        const mealForm = document.querySelector('#mealplans form');
        if (mealForm) {
          mealForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const result = await addMeal({
              name: formData.get('mealName'),
              type: formData.get('mealType'),
              description: formData.get('description'),
              calories: parseFloat(formData.get('calories')) || null,
              carbs: parseFloat(formData.get('carbs')) || null,
              protein: parseFloat(formData.get('protein')) || null,
              fat: parseFloat(formData.get('fat')) || null,
              fiber: parseFloat(formData.get('fiber')) || null,
            });

            if (result.success) {
              e.target.reset();
              alert('Meal logged successfully!');
              loadDashboardData();
            } else {
              alert('Error logging meal: ' + result.error);
            }
          });
        }

        // Glucose logging (quick add button)
        const glucoseBtn = document.getElementById('quickAddGlucose');
        if (glucoseBtn) {
          glucoseBtn.addEventListener('click', async () => {
            const value = prompt('Enter glucose value (mg/dL):');
            const context = prompt('Context (fasting/before_meal/after_meal/bedtime/random):');
            
            if (value && context) {
              const result = await addGlucoseReading({
                value: parseFloat(value),
                context: context
              });

              if (result.success) {
                alert('Glucose reading added!');
                loadDashboardData();
              } else {
                alert('Error: ' + result.error);
              }
            }
          });
        }
      }

      // Display functions
      function displayRecentMeals(meals) {
        const container = document.getElementById('recentMealsList');
        if (!container) return;

        if (meals.length === 0) {
          container.innerHTML = '<p class="text-muted">No meals logged yet</p>';
          return;
        }

        container.innerHTML = meals.slice(0, 5).map(meal => `
          <div class="meal-item mb-2 p-2 border-bottom">
            <strong>${meal.meal_name}</strong> - ${meal.meal_type || 'N/A'}
            <br>
            <small class="text-muted">${new Date(meal.meal_time).toLocaleDateString()}</small>
            ${meal.calories ? `<br><small>${meal.calories} cal, ${meal.carbohydrates || 0}g carbs</small>` : ''}
          </div>
        `).join('');
      }

      function displayGlucoseStats(readings) {
        if (readings.length === 0) return;

        const values = readings.map(r => r.glucose_value);
        const avg = (values.reduce((a, b) => a + b, 0) / values.length).toFixed(1);
        const latest = values[0];

        const avgElement = document.getElementById('avgGlucose');
        const latestElement = document.getElementById('latestGlucose');

        if (avgElement) avgElement.textContent = avg + ' mg/dL';
        if (latestElement) latestElement.textContent = latest + ' mg/dL';
      }

      function displayUserProfile(profile) {
        const nameElement = document.getElementById('profileFullName');
        const diabetesTypeElement = document.getElementById('profileDiabetesType');

        if (nameElement && profile.full_name) {
          nameElement.textContent = profile.full_name;
        }
        if (diabetesTypeElement && profile.diabetes_type) {
          diabetesTypeElement.textContent = profile.diabetes_type.charAt(0).toUpperCase() + profile.diabetes_type.slice(1);
        }
      }

      // Make functions globally available
      window.dashboardFunctions = {
        addMeal,
        getMeals,
        addGlucoseReading,
        getGlucoseReadings,
        addUserMetric,
        getUserMetrics,
        updateUserProfile,
        getUserProfile,
        loadDashboardData
      };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
